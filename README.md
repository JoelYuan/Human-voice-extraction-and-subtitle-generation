# 人音提取与字幕生成工具

本项目包含两个版本的音频处理工具，能够提取人声音频并自动生成字幕：
1. **原始版本**：CPU运行，适合所有设备
2. **GPU加速版**：支持GPU加速，处理速度更快

## 项目文件说明

- `YTool_人音提取与字幕生成.py`：原始CPU版本
- `YTool_人音提取与字幕生成_GPU版.py`：GPU加速版本
- `requirements.txt`：原始版本所需依赖
- `requirements-RTX5060.txt`：GPU加速版本所需依赖（适用于RTX 5060及类似GPU）

## 功能介绍

两个版本的核心功能相同：
- 提取人声音频
- 自动生成字幕文件
- 支持多种音频/视频格式输入
- 支持SRT、VTT、ASS、TXT多种字幕格式输出
- 音频增强（噪音消除、语音增强、音量归一化、均衡器调整）

### 版本差异

| 功能 | 原始版本 | GPU加速版 |
|------|---------|-----------|
| 运行设备 | CPU | CPU/GPU (自动检测) |
| 处理速度 | 较慢 | 显著提升 |
| 模型自动下载 | 不支持 | 支持 |
| 依赖库 | 基础版本 | 包含GPU加速库 |
| 兼容性选项 | 基础 | 多GPU后端支持 |

## 环境要求

### 通用要求

- Python 3.10.18
- FFmpeg（需安装并添加到系统PATH中）
- Windows操作系统（推荐）

### GPU加速版额外要求

- NVIDIA GPU (RTX 5060及更高版本)
- 最新的NVIDIA驱动程序

## 安装依赖

### 原始版本

```bash
pip install -r requirements.txt
```

### GPU加速版

```bash
pip install -r requirements-RTX5060.txt
```

## 模型准备

使用本工具前，需要准备以下两个模型（两个版本共用）：

### 1. faster-whisper-medium模型（约1.42GB）

可以使用提供的下载脚本快速获取：

```bash
python 魔搭下载faster-whisper-medium.py
```

下载完成后，确保`faster-whisper-medium`文件夹位于项目根目录。

### 2. silero-vad模型（约10.4MB）

使用git克隆或直接下载：

```bash
git clone https://huggingface.co/onnx-community/silero-vad
```

下载完成后，确保`silero-vad`文件夹位于项目根目录。

## 使用说明

### 原始版本使用方法

1. 安装所有依赖和准备好模型后，运行主程序：

```bash
python YTool_人音提取与字幕生成.py
```

2. 在界面中选择要处理的音频或视频文件

3. 选择输出的字幕格式（SRT、VTT、ASS、TXT）

4. 根据需要启用或禁用音频增强选项

5. 点击"开始处理"按钮开始提取人声和生成字幕

6. 处理完成后，字幕文件将保存在与源文件相同的目录中

### GPU加速版使用方法

1. 确保已安装NVIDIA GPU驱动和CUDA相关组件

2. 安装所有依赖和准备好模型后，运行主程序：

```bash
python YTool_人音提取与字幕生成_GPU版.py
```

3. 程序会自动检测可用的GPU，如果GPU不可用会自动回退到CPU模式

4. 后续操作与原始版本相同：选择文件、设置字幕格式、配置音频增强选项、点击开始处理

## 功能特点

### 两个版本共有的功能

- **音频增强**：包含噪音消除、语音增强、音量归一化和均衡器调整等功能
- **多格式支持**：支持多种音频和视频格式输入，以及多种字幕格式输出
- **用户友好界面**：简洁直观的图形界面，方便操作
- **人音提取**：自动检测并提取音频中的人声部分
- **字幕生成**：自动将人声转换为文本字幕

### GPU加速版特有的功能

- **GPU加速**：支持CUDA和DirectML GPU加速，显著提高处理速度
- **自动模型下载**：如果本地模型不存在，会尝试自动下载
- **多GPU后端支持**：可根据系统环境自动选择最佳的GPU加速方式

## 注意事项

### 通用注意事项

- 处理大型文件时可能需要较长时间，请耐心等待
- 确保模型文件正确放置在项目根目录
- 确保FFmpeg已正确安装并添加到系统PATH

### GPU加速版额外注意事项

- GPU加速功能需要正确安装CUDA驱动和相关库
- 如果GPU加速不可用，程序会自动回退到CPU模式
- GPU模式下可能会消耗更多系统资源

## 故障排除

### 通用问题排查

如果遇到问题，请检查：
1. FFmpeg是否正确安装并添加到PATH
2. 模型文件是否正确放置在根目录
3. 所有Python依赖是否已正确安装（使用对应版本的requirements文件）
4. 输入文件是否损坏或格式不受支持

### GPU加速版特有问题排查

如果GPU加速不可用，请检查：
1. NVIDIA GPU驱动是否为最新版本
2. CUDA和cuDNN是否正确安装
3. 是否使用了正确的requirements-RTX5060.txt安装依赖
4. 系统是否有足够的可用内存和GPU显存